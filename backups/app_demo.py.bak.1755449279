#!/usr/bin/env python3
import json
from pathlib import Path
from flask import Flask, request, send_from_directory, jsonify
from coil_classifier import (
    coil_classify, footprint_for_semiprime,
    geometry_signature, invariant_signature,
)

APP_DIR = Path(__file__).parent.resolve()
WEB_DIR = APP_DIR / "web"
CACHE_DIR = APP_DIR / "cache"
WEB_DIR.mkdir(exist_ok=True)
CACHE_DIR.mkdir(exist_ok=True)

from typing import Any

def _to_int(x: Any, default: int) -> int:
    try:
        s = str(x)
        if not s or s.lower() == "none":
            return default
        return int(s)
    except Exception:
        return default


def _to_float(x: Any, default: float) -> float:
    try:
        s = str(x)
        if not s or s.lower() == "none" or s.startswith("[object "):
            return default
        return float(s)
    except Exception:
        return default

